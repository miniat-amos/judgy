{% extends 'judgy/base.html' %}

{% block title %}{{ competition.name }} Admin Interface {% endblock %}


{% block main %}

<script>
  $(async () => {

      const response = await fetch("{% url 'competition:competition_teams' competition.code %}");
      const teams = await response.json();

      $('#teams').empty();

        for (const team of teams) {

          const member_url = "{% url 'competition:team_members' competition.code 'team.name' %}".replace('team.name', encodeURIComponent(team.name));

          const response = await fetch(member_url);
          const members = await response.json();

          let membersHTML = ""

          for (const member of members) {
            membersHTML += `
              <div class="col">
                <div class="text-center">
                  
                  <i class="bi bi-person-circle" style="font-size: 4rem"></i>
                  <h4>${member.first_name}</h4>
                  <h5>${member.email}</h5>
                </div>
              </div>
              `
          }
          
          const team_admin_url = "{% url 'competition:admin_team_interface' competition.code 'team.name' %}".replace('team.name', encodeURIComponent(team.name));

          $('#teams').append(`
          <div class="card bg-body-tertiary">
                <a href=${team_admin_url} style="text-decoration: none; color: white;">
              <div class="card-body">
                    <h3 class="card-title">Team: 
                    ${team.name}
                    </h3>
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                  ${membersHTML}
                </div>
              </div>
            </div>
            </a>
          </div>
          <br>
          `);
        }

  });
</script>



<div class="container py-5">
  
    <div class="mb-5">
        <h1 class="text-center">Admin Interface for {{ competition.name }}</h1>
    </div>

  <div class="mt-1 mb-3">
    <h1 class="text-center">Problems</h1>
  </div>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
    {% for problem in problems %}
      <div class="col">
        <a class="text-decoration-none text-reset" href="{% url 'competition:admin_problem_submissions' competition.code problem.name %}">
          <div class="card h-100 bg-body-tertiary">
            <div class="card-body d-flex flex-column gap-2">
              <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Problem {{ problem.number }}</h4>
                {% if problem.subjective %}
                  <span class="badge text-bg-warning text-dark">Subjective</span>
                {% else %}
                  <span class="badge text-bg-primary">Auto Judged</span>
                {% endif %}
              </div>
              <h5 class="fw-semibold">{{ problem.name }}</h5>
              <p class="text-muted mb-0">Click to review submissions</p>
            </div>
          </div>
        </a>
      </div>
    {% empty %}
      <div class="col">
        <div class="alert alert-info mb-0">No problems have been added yet.</div>
      </div>
    {% endfor %}
  </div>

  <div class="mt-1">
    <h1 class="text-center">Teams</h1>
  </div>
  <div class="row row-cols-1 g-4">
    <div id="teams">
    </div>
  </div>
</div>



{% endblock %}
