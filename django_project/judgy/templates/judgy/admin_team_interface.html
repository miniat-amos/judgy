{% extends 'judgy/base.html' %}

{% block title %}{{ competition.name }} Admin Interface {% endblock %}

{% block main %}

<script>
$(async () => {

        const member_scores_url = "{% url 'judgy:members_scores' competition.code team.name %}"

        const response = await fetch(member_scores_url);
        const member_scores = await response.json();

        $('#team-members').empty();

        let memberHTML = "";
        let scoresHTML = "";

        const scoresTable = `
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Problem #</th>
                <th scope="col">Problem</th>
                <th scope="col">Score</th>
                <th scope="col">Download Source Code</th>
                <th scope="col">Input Score</th>
              </tr>
            </thead>
            <tbody>

            </tbody>
          </table>
        `;

        let inputScore = `
          <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Input Score" aria-label="Input Score" aria-describedby="button-addon2">
            <button class="btn btn-success" type="button" id="button-addon2">Submit</button>
          </div>
        `
        
        for (const [email, member] of Object.entries(member_scores.members)) {
  
          let subjectiveProblemHtml = $(scoresTable).attr('id', 'subjective-table');
          let autoJudgedProblemHtml = $(scoresTable).attr('id', 'auto-judged-table');

          memberHTML = `
        
              <div class="container d-flex align-items-center justify-content-around mb-5">
                <i class="bi bi-person-circle" style="font-size: 4rem"></i>
                <h4 class="card-title">Name: ${member.first_name} ${member.last_name}</h4>
                <h4 class="card-title">Email: ${email}</h4>
              </div>

            `;
            
            for (const [problem_name, problem_data] of Object.entries(member.scores))
            {

                scoresHTML = `
                  <tr>
                    <th scope="row">${problem_data.problem_number}</th>
                    <td>${problem_name}</td>
                    <td>${problem_data.member_score !== "" ? problem_data.member_score : "--"}</td>
                    <td></td>
                    <td>${inputScore}</td>
                  </tr>
                `;

                if (problem_data.subjective === true)
                {
                    subjectiveProblemHtml.find('tbody').append(scoresHTML);
                }
                else
                {
                    autoJudgedProblemHtml.find('tbody').append(scoresHTML);

                }
            }

            $('#team-members').append(`
              <div class="card bg-body-tertiary">
                  <div class="card-body">
                      ${memberHTML}
                      <div>
                        <h4 class="text-center">Subjective Problems</h4>
                        ${subjectiveProblemHtml.prop('outerHTML')}
                      </div>
                      <div class="mt-3">
                        <h4 class="text-center">Auto Judged Problems</h4>
                        ${autoJudgedProblemHtml.prop('outerHTML')}
                      </div>
                  </div>
                </div>
              </div>
              <br>
            `);
                
        }

      }
    );
</script>

<div class="container py-5">

  <div class="mb-5">
    <h1 class="text-center">Admin Interface for {{ team.name }}</h1>
  </div>

  <div class="mt-1">
    <h1 class="text-center">Members</h1>
  </div>
  <div class="row row-cols-1 g-4">
    <div id="team-members">
    </div>
  </div>
</div>

{% endblock %}